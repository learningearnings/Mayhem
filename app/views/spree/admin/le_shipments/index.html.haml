%h1 Shipping
%table.table.table-bordered.table-striped
  %tr
    %th Order Number
    %th Order Status
    %th School
    %th Item Count
    %th Items
    %th.currency Total
    %th Actions
  - @shipments.each do |order|
    %tr
      %td.order-number= link_to order.number, admin_order_path(order)
      %td= order.state
      %td= order.ship_address.company rescue School.find(YAML.load(order.special_instructions)[:school_id]).name
      %td= order.line_items.count
      %td= order.line_items.collect do |li| li.product.name end.uniq.join(', ')
      %td= number_to_currency(order.total)
      %td
        .btn-group
          = link_to "Print", admin_le_print_order_path(order) , :class => "btn print"
          &nbsp;&nbsp;|&nbsp;&nbsp;
          = link_to "Edit", edit_admin_order_path(order) , :class => "btn edit"
          &nbsp;&nbsp;|&nbsp;&nbsp;
          = link_to("Ship", "#", :id => "#{order.id}", :class => "btn ship")

#shipping_options
  = form_tag (admin_le_ship_order_path) do
    #order
    %p
    = label_tag :tracking_number
    = text_field_tag :tracking_number
    %p
    = label_tag 'Shipping Method' 
    = select_tag :shipping_method, options_from_collection_for_select(Spree::ShippingMethod.all, 'id', 'name'), :include_blank => true
    %p
    = hidden_field_tag :order_id, :id => "order_id"
    = submit_tag
    = link_to "Cancel", '#', class: 'cancel'

:javascript
  $(document).ready(function() {
    $('#shipping_options').hide();
  });
  $('.cancel').click(function() {
    $('#shipping_options').hide();
  });
  $(".ship").click(function(e) {
    $('#shipping_options').show();
    var order_id = $(this).parent().siblings('.order-number').html();
    $('#order').html(order_id);
    $('#order_id').val(order_id);
  });
  $(document).click(function(e) {
    var target = $(e.target);
    if(target.hasClass('ship')){
      return false;
    }
    if(target.closest('#shipping_options').length == 0){
      $('#shipping_options').hide();
    }
  });
