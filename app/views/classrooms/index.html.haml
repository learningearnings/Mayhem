.main-content-wrapper

  .primary-content
    .create-classroom
      %h3 Create a Classroom
      %hr
      = form_for Classroom.new, html: intro_tour(2, 'create_classroom', current_person, {}) do |f|
        = f.label :classroom_name
        = f.text_field :name, :class => 'focus-on-me'
        = f.hidden_field :school_id, :value => current_school.id
        = f.submit 'Create', :class => "awesome-button submit"


  .secondary-content
    %h2 Classrooms
    #classrooms
      - if @classrooms.present?
        - @classrooms.each_with_index do |classroom, index|
          - if (index == 0)
            %h3
              = link_to classroom.name, classroom_path(classroom), intro_tour(3,'add_students_to_class',current_person,{:class => "classroom" })
          - else
            %h3
              = link_to classroom.name, classroom_path(classroom), {class: "classroom"}

%script#classroom_list{ type: 'text/html' }
  :plain
    {{#classrooms}}
      <h3 data-id={{id}}>
        <a href="/classrooms/{{id}}?tour=Y">{{name}}</a>
      </h3>
    {{/classrooms}}

= javascript_include_tag "tours/school_admin/overview"
= javascript_include_tag "tours/teacher/overview"

:javascript
  if (hopscotch.getState() === "school_admin_overview:5") {
    hopscotch.startTour(school_admin_overview);
  } else if (hopscotch.getState() === "teacher_overview:6") {
    hopscotch.startTour(teacher_overview);
  }

  $('.submit').click(function(e) {
    e.preventDefault();
    var $form = $('#new_classroom');
    var values = $form.serialize();

    $.ajax({
      type: "POST",
      url: $form.attr('action'),
      data: values,
      dataType: 'JSON'
    }).success(function(response) {
      if (response.status == "ok") {
        var classroom = response.classroom.classroom;
        var classrooms = $.map(response.classrooms, function(classroom) {
          return classroom.classroom;
        });
        ich.grabTemplates();
        var html = ich.classroom_list({classrooms: classrooms});
        $('#classrooms').html(html);

        // Set tour step for newly created class
        var $el = $('[data-id='+classroom.id+'] a')
        $el.addClass('introjs-showElement introjs-relativePosition');
        $el.attr('data-intro', 'Here you can see your newly created classroom.');
        $el.attr('data-step', '3');

        // If Tour is running, proceed to next step
        if (typeof classroomIntro != "undefined") {
          classroomIntro.refresh();
          classroomIntro.nextStep();
        }
      }
    });
  });

  var classroomIntro = introJs().setOptions({'doneLabel': 'Next page'}).start().oncomplete(function() {
    window.location.href = "/store?multipage=true&tour=Y";
  });
