/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
!function(){function e(e){return CKEDITOR.env.ie?e.$.clientWidth:parseInt(e.getComputedStyle("width"),10)}function t(e,t){var n=e.getComputedStyle("border-"+t+"-width"),i={thin:"0px",medium:"1px",thick:"2px"};return n.indexOf("px")<0&&(n=n in i&&"none"!=e.getComputedStyle("border-style")?i[n]:0),parseInt(n,10)}function n(e){for(var t,n,i,a=e.$.rows,o=0,r=0,s=a.length;s>r;r++)i=a[r],t=i.cells.length,t>o&&(o=t,n=i);return n}function i(e){for(var i=[],a=-1,o="rtl"==e.getComputedStyle("direction"),r=n(e),s=new CKEDITOR.dom.element(e.$.tBodies[0]),l=s.getDocumentPosition(),d=0,c=r.cells.length;c>d;d++){var u=new CKEDITOR.dom.element(r.cells[d]),h=r.cells[d+1]&&new CKEDITOR.dom.element(r.cells[d+1]);a+=u.$.colSpan||1;var p,m,g,f=u.getDocumentPosition().x;o?m=f+t(u,"left"):p=f+u.$.offsetWidth-t(u,"right"),h?(f=h.getDocumentPosition().x,o?p=f+h.$.offsetWidth-t(h,"right"):m=f+t(h,"left")):(f=e.getDocumentPosition().x,o?p=f:m=f+e.$.offsetWidth),g=Math.max(m-p,3),i.push({table:e,index:a,x:p,y:l.y,width:g,height:s.$.offsetHeight,rtl:o})}return i}function a(e,t){for(var n=0,i=e.length;i>n;n++){var a=e[n];if(t>=a.x&&t<=a.x+a.width)return a}return null}function o(e){(e.data||e).preventDefault()}function r(n){function i(){p=null,b=0,f=0,m.removeListener("mouseup",u),g.removeListener("mousedown",c),g.removeListener("mousemove",h),m.getBody().setStyle("cursor","auto"),d?g.remove():g.hide()}function a(){for(var t=p.index,n=CKEDITOR.tools.buildTableMap(p.table),i=[],a=[],r=Number.MAX_VALUE,s=r,l=p.rtl,d=0,c=n.length;c>d;d++){var u=n[d],C=u[t+(l?1:0)],T=u[t+(l?0:1)];C=C&&new CKEDITOR.dom.element(C),T=T&&new CKEDITOR.dom.element(T),C&&T&&C.equals(T)||(C&&(r=Math.min(r,e(C))),T&&(s=Math.min(s,e(T))),i.push(C),a.push(T))}y=i,k=a,_=p.x-r,w=p.x+s,g.setOpacity(.5),v=parseInt(g.getStyle("left"),10),b=0,f=1,g.on("mousemove",h),m.on("dragstart",o)}function r(){f=0,g.setOpacity(0),b&&s();var e=p.table;setTimeout(function(){e.removeCustomData("_cke_table_pillars")},0),m.removeListener("dragstart",o)}function s(){for(var n=p.rtl,i=n?k.length:y.length,a=0;i>a;a++){var o=y[a],r=k[a],s=p.table;CKEDITOR.tools.setTimeout(function(e,t,i,a,o,r){e&&e.setStyle("width",l(Math.max(t+r,0))),i&&i.setStyle("width",l(Math.max(a-r,0))),o&&s.setStyle("width",l(o+r*(n?-1:1)))},0,this,[o,o&&e(o),r,r&&e(r),(!o||!r)&&e(s)+t(s,"left")+t(s,"right"),b])}}function c(e){o(e),a(),m.on("mouseup",u,this)}function u(e){e.removeListener(),r()}function h(e){C(e.data.$.clientX)}var p,m,g,f,v,b,y,k,_,w;m=n.document,g=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',m),d||m.getDocumentElement().append(g),this.attachTo=function(e){f||(d&&(m.getBody().append(g),b=0),p=e,g.setStyles({width:l(e.width),height:l(e.height),left:l(e.x),top:l(e.y)}),d&&g.setOpacity(.25),g.on("mousedown",c,this),m.getBody().setStyle("cursor","col-resize"),g.show())};var C=this.move=function(e){if(!p)return 0;if(!f&&(e<p.x||e>p.x+p.width))return i(),0;var t=e-Math.round(g.$.offsetWidth/2);if(f){if(t==_||t==w)return 1;t=Math.max(t,_),t=Math.min(t,w),b=t-v}return g.setStyle("left",l(t)),1}}function s(e){var t=e.data.getTarget();if("mouseout"==e.name){if(!t.is("table"))return;for(var n=new CKEDITOR.dom.element(e.data.$.relatedTarget||e.data.$.toElement);n&&n.$&&!n.equals(t)&&!n.is("body");)n=n.getParent();if(!n||n.equals(t))return}t.getAscendant("table",1).removeCustomData("_cke_table_pillars"),e.removeListener()}var l=CKEDITOR.tools.cssLength,d=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks||CKEDITOR.env.version<7);CKEDITOR.plugins.add("tableresize",{requires:["tabletools"],init:function(e){e.on("contentDom",function(){var t;e.document.getBody().on("mousemove",function(n){if(n=n.data,t&&t.move(n.$.clientX))return o(n),void 0;var l,d,c=n.getTarget();if(c.is("table")||c.getAscendant("tbody",1)){l=c.getAscendant("table",1),(d=l.getCustomData("_cke_table_pillars"))||(l.setCustomData("_cke_table_pillars",d=i(l)),l.on("mouseout",s),l.on("mousedown",s));var u=a(d,n.$.clientX);u&&(!t&&(t=new r(e)),t.attachTo(u))}})})}})}();