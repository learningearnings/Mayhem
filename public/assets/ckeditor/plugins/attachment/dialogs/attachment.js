!function(){CKEDITOR.dialog.add("attachment",function(e){function t(e){var t=e.split("/").pop(),n=t.split(".").pop();return{filename:t,className:"attach_"+n}}var n=/^(_(?:self|top|parent|blank))$/,i=function(e,t){var i=t?t.getAttribute("_cke_saved_href")||t.getAttribute("href"):"",r={};if(r.type="url",r.url=i,t){var o=t.getAttribute("target");if(r.target={},o){var a=o.match(n);a?r.target.type=r.target.name=o:(r.target.type="frame",r.target.name=o)}r.title=t.getAttribute("title")}for(var s=e.document.getElementsByTag("img"),l=new CKEDITOR.dom.nodeList(e.document.$.anchors),c=r.anchors=[],d=0;d<s.count();d++){var u=s.getItem(d);u.getAttribute("_cke_realelement")&&"anchor"==u.getAttribute("_cke_real_element_type")&&c.push(e.restoreRealElement(u))}for(d=0;d<l.count();d++)c.push(l.getItem(d));for(d=0;d<c.length;d++)u=c[d],c[d]={name:u.getAttribute("name"),id:u.getAttribute("id")};return this._.selectedElement=t,r},r=function(){var t=this.getDialog(),n=t.getContentElement("general","linkTargetName"),i=this.getValue();n&&(n.setLabel(e.lang.link.targetFrameName),this.getDialog().setValueOf("general","linkTargetName","_"==i.charAt(0)?i:""))};return{title:e.lang.attachment.title,minWidth:420,minHeight:200,onShow:function(){this.fakeObj=!1;var e=this.getParentEditor(),t=e.getSelection(),n=t.getRanges(),r=null;if(1==n.length){var o=n[0].getCommonAncestor(!0);r=o.getAscendant("a",!0),r&&r.getAttribute("href")?t.selectElement(r):(r=o.getAscendant("img",!0))&&r.getAttribute("_cke_real_element_type")&&"anchor"==r.getAttribute("_cke_real_element_type")?(this.fakeObj=r,r=e.restoreRealElement(this.fakeObj),t.selectElement(this.fakeObj)):r=null}this.setupContent(i.apply(this,[e,r]))},onOk:function(){var e={href:"javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"},n=[],i={href:e.href},r=this.getParentEditor();this.commitContent(i);var o=i.url||"";e._cke_saved_href=0===o.indexOf("/")?o:"http://"+o;var a=t(o);if(i.title||"",e.title=0==i.title.length?a.filename:i.title,e["class"]=a.className,i.target&&("notSet"!=i.target.type&&i.target.name?e.target=i.target.name:n.push("target"),n.push("_cke_pa_onclick","onclick")),this._.selectedElement){var s=this._.selectedElement;if(CKEDITOR.env.ie&&e.name!=s.getAttribute("name")){var l=new CKEDITOR.dom.element('<a name="'+CKEDITOR.tools.htmlEncode(e.name)+'">',r.document);c=r.getSelection(),s.moveChildren(l),s.copyAttributes(l,{name:1}),l.replace(s),s=l,c.selectElement(s)}s.setAttributes(e),s.removeAttributes(n),s.getAttribute("title")&&s.setHtml(s.getAttribute("title")),s.getAttribute("name")?s.addClass("cke_anchor"):s.removeClass("cke_anchor"),this.fakeObj&&r.createFakeElement(s,"cke_anchor","anchor").replace(this.fakeObj),delete this._.selectedElement}else{var c=r.getSelection(),d=c.getRanges();if(1==d.length&&d[0].collapsed){var u=new CKEDITOR.dom.text(e.title,r.document);d[0].insertNode(u),d[0].selectNodeContents(u),c.selectRanges(d)}var h=new CKEDITOR.style({element:"a",attributes:e});h.type=CKEDITOR.STYLE_INLINE,h.apply(r.document)}},contents:[{label:e.lang.common.generalTab,id:"general",accessKey:"I",elements:[{type:"vbox",padding:0,children:[{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(e.lang.attachment.url)+"</span>"},{type:"hbox",widths:["280px","110px"],align:"right",children:[{id:"src",type:"text",label:"",validate:CKEDITOR.dialog.validate.notEmpty(e.lang.flash.validateSrc),setup:function(e){e.url&&this.setValue(e.url),this.select()},commit:function(e){e.url=this.getValue()}},{type:"button",id:"browse",filebrowser:"general:src",hidden:!0,align:"center",label:e.lang.common.browseServer}]}]},{type:"vbox",padding:0,children:[{id:"name",type:"text",label:e.lang.attachment.name,setup:function(e){e.title&&this.setValue(e.title)},commit:function(e){e.title=this.getValue()}}]},{type:"hbox",widths:["50%","50%"],children:[{type:"select",id:"linkTargetType",label:e.lang.link.target,"default":"notSet",style:"width : 100%;",items:[[e.lang.link.targetNotSet,"notSet"],[e.lang.link.targetFrame,"frame"],[e.lang.link.targetNew,"_blank"],[e.lang.link.targetTop,"_top"],[e.lang.link.targetSelf,"_self"],[e.lang.link.targetParent,"_parent"]],onChange:r,setup:function(e){e.target&&this.setValue(e.target.type)},commit:function(e){e.target||(e.target={}),e.target.type=this.getValue()}},{type:"text",id:"linkTargetName",label:e.lang.link.targetFrameName,"default":"",setup:function(e){e.target&&this.setValue(e.target.name)},commit:function(e){e.target||(e.target={}),e.target.name=this.getValue()}}]}]},{id:"Upload",hidden:!0,filebrowser:"uploadButton",label:e.lang.common.upload,elements:[{type:"file",id:"upload",label:e.lang.common.upload,size:38},{type:"fileButton",id:"uploadButton",label:e.lang.common.uploadSubmit,filebrowser:"general:src","for":["Upload","upload"]}]}]}})}();